scale_x_continuous(breaks = seq(1991, 2024, 1)) +
scale_y_continuous(limits = c(-5, 10),labels = label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
View(pob2_small)
pop_diff <- pob2_small %>%
filter(ANY %in% c(1990, 2024)) %>%
select(NOM_ENS, ANY, TOTAL) %>%
pivot_wider(names_from = ANY, values_from = TOTAL, names_prefix = "YEAR_") %>%
mutate(
diff_TOTAL = YEAR_2024 - YEAR_1990,
perc_CHANGE = (YEAR_2024 - YEAR_1990) / YEAR_1990 * 100
)
# Step 2: Convert NOM_ENS to factor ordered by diff_TOTAL
pop_diff <- pop_diff %>%
mutate(NOM_ENS = fct_reorder(NOM_ENS, diff_TOTAL))
# Step 3: Boxplot (one box per NOM_ENS showing the difference)
ggplot(pop_diff, aes(x = NOM_ENS, y = diff_TOTAL, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("FALSE" = "grey80", "TRUE" = "green")) +
coord_flip() +
labs(
x = "",
y = "Diferència població (1990-2024)\nmunicipis de la demarcació de Barcelona\nque el 1990 tenien entre 5000 i 9000 habitants"
) +
theme_minimal(base_size = 20) +
theme(
legend.position = "none",
axis.title.y = element_text(size = 12)  # smaller y-axis title
)
View(pop_diff)
ggplot(pob2_small, aes(x = ANY, y = growth_pct)) +
# punts grisos per a tots menys Cardedeu
geom_point(data = pob2_small %>% filter(NOM_ENS != "Cardedeu"),
color = "grey70", alpha = 0.6, size = 4) +
geom_point(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", size = 3) +
geom_line(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", line_width = 1.5) +
geom_point(data = pob2_small %>% filter(NOM_ENS == "Llinars del Vallès"),
color = "red", size = 3) +
geom_line(data = pob2_small %>% filter(NOM_ENS == "Llinars del Vallès"),
color = "red", line_width = 1.5) +
labs(
title = "",
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
scale_y_continuous(limits = c(-5, 10),labels = label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
top3 <- pob2_small %>%
group_by(ANY) %>%
slice_max(order_by = growth_pct, n = 3) %>%
ungroup()
ggplot(pob2_small, aes(x = ANY, y = growth_pct)) +
# punts grisos per a tots menys Cardedeu
geom_point(data = pob2_small %>% filter(NOM_ENS != "Cardedeu"),
color = "grey70", alpha = 0.6, size = 4) +
geom_point(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", size = 3) +
geom_line(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", line_width = 1.5) +
# add labels for top 3
geom_text_repel(
data = top3,
aes(label = NOM_ENS),
size = 4,
nudge_y = 0.5,
min.segment.length = 0
) +
labs(
title = "",
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
scale_y_continuous(limits = c(-5, 10), labels = scales::label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
library(ggrepel)
top3 <- pob2_small %>%
group_by(ANY) %>%
slice_max(order_by = growth_pct, n = 3) %>%
ungroup()
ggplot(pob2_small, aes(x = ANY, y = growth_pct)) +
# punts grisos per a tots menys Cardedeu
geom_point(data = pob2_small %>% filter(NOM_ENS != "Cardedeu"),
color = "grey70", alpha = 0.6, size = 4) +
geom_point(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", size = 3) +
geom_line(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", line_width = 1.5) +
# add labels for top 3
geom_text_repel(
data = top3,
aes(label = NOM_ENS),
size = 4,
nudge_y = 0.5,
min.segment.length = 0
) +
labs(
title = "",
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
scale_y_continuous(limits = c(-5, 10), labels = scales::label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
top1 <- pob2_small %>%
group_by(ANY) %>%
slice_max(order_by = growth_pct, n = 1) %>%
ungroup()
ggplot(pob2_small, aes(x = ANY, y = growth_pct)) +
# punts grisos per a tots menys Cardedeu
geom_point(data = pob2_small %>% filter(NOM_ENS != "Cardedeu"),
color = "grey70", alpha = 0.6, size = 4) +
geom_point(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", size = 3) +
geom_line(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", line_width = 1.5) +
# add labels for top 3
geom_text_repel(
data = top1,
aes(label = NOM_ENS),
size = 4,
nudge_y = 0.5,
min.segment.length = 0
) +
labs(
title = "",
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
scale_y_continuous(limits = c(-5, 10), labels = scales::label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
names(pob2_small)
names(pob2_small$NOM_ENS)
levels(pob2_small$NOM_ENS)
library(stringr)
library(ggplot2)
library(dplyr)
library(tidyr)
library(magrittr)
library(scales)
library(forcats)
pob2 <- read.csv("C:/Users/marcs/Google Drive/Z-Resta/Cardedeu/Població/pob2.csv", sep = ",", encoding = "UTF-8")
pob2$NOM_ENS <- gsub("^Ajuntament de ", "", pob2$NOM_ENS)
pob2$NOM_ENS <- gsub("^Ajuntament d'", "", pob2$NOM_ENS)
pob2 <- pob2 %>% filter(str_starts(CODI_10, "8"))
pob2 <- pob2 %>%
filter(!str_starts(NOM_ENS, "Consell Comarcal") & !str_starts(NOM_ENS, "Diputació") & !str_starts(NOM_ENS, "Conselh"))
pob2 <- pob2 %>%
arrange(NOM_ENS, ANY) %>%
group_by(NOM_ENS) %>%
mutate(
TOTAL = as.numeric(gsub("\\.", "", TOTAL)),   # clean & convert
growth_abs = TOTAL - lag(TOTAL),             # absolute growth per year
growth_pct = (TOTAL - lag(TOTAL)) / lag(TOTAL) * 100  # % growth per year
) %>%
ungroup()
small_munis <- pob2 %>%
filter(ANY == 1990 & TOTAL > 5000 & TOTAL < 10000) %>%
pull(NOM_ENS)
library(stringr)
library(ggplot2)
library(dplyr)
library(tidyr)
library(magrittr)
library(scales)
library(forcats)
## Dades població més antigues 1990
pob2 <- read.csv("C:/Users/marcs/Google Drive/Z-Resta/Cardedeu/Població/pob2.csv", sep = ",", encoding = "UTF-8")
pob2$NOM_ENS <- gsub("^Ajuntament de ", "", pob2$NOM_ENS)
pob2$NOM_ENS <- gsub("^Ajuntament d'", "", pob2$NOM_ENS)
pob2 <- pob2 %>% filter(str_starts(CODI_10, "8"))
pob2 <- pob2 %>%
filter(!str_starts(NOM_ENS, "Consell Comarcal") & !str_starts(NOM_ENS, "Diputació") & !str_starts(NOM_ENS, "Conselh"))
pob2 <- pob2 %>%
arrange(NOM_ENS, ANY) %>%
group_by(NOM_ENS) %>%
mutate(
TOTAL = as.numeric(gsub("\\.", "", TOTAL)),   # clean & convert
growth_abs = TOTAL - lag(TOTAL),             # absolute growth per year
growth_pct = (TOTAL - lag(TOTAL)) / lag(TOTAL) * 100  # % growth per year
) %>%
ungroup()
small_munis <- pob2 %>%
filter(ANY == 1990 & TOTAL > 5000 & TOTAL < 10000) %>%
pull(NOM_ENS)
# Keep all years for these municipalities
pob2_small <- pob2 %>%
filter(NOM_ENS %in% small_munis)
View(pob2_small)
small_munis
# Crear un data frame con los municipios y sus superficies
municipios_area <- tibble::tribble(
~NOM_ENS,                  ~area_km2,
"Abrera",                  19.94,
"Alella",                  9.58,
"Argentona",               25.40,
"Canet de Mar",            5.56,
"Cardedeu",                12.10,
"Cardona",                 66.70,
"Centelles",               15.18,
"Cervelló",                24.10,
"Gironella",               6.78,
"Llinars del Vallès",      27.63,
"Montgat",                 2.91,
"Montmeló",                4.00,
"Navarcles",               5.50,
"Navàs",                   80.60,
"Palau-solità i Plegamans",14.93,
"Pallejà",                 8.30,
"Piera",                   57.20,
"Premià de Dalt",          6.57,
"Puig-reig",               45.75,
"Sallent",                 65.22,
"Sant Joan de Vilatorrada",16.43,
"Sant Quirze del Vallès", 14.07,
"Sant Sadurní d’Anoia",    18.96,
"Sant Vicenç de Castellet",17.13,
"Santa Margarida de Montbui",27.59,
"Súria",                   23.60,
"Tona",                    16.54,
"Tordera",                 83.97,
"Vallirana",               23.88,
"Vilanova del Camí",       10.28,
"Vilassar de Dalt",        8.87,
"La Garriga",              18.80,
"La Roca del Vallès",      36.90
)
# Unir con tu conjunto de datos pob2_small
pob2_with_area <- pob2_small %>%
left_join(municipios_area, by = "NOM_ENS")
# Verificar los resultados
head(pob2_with_area)
View(pob2_with_area)
View(municipios_area)
# Unir con tu conjunto de datos pob2_small
pob2_with_area <- pob2_small %>%
left_join(municipios_area, by = "NOM_ENS")
View(pob2_with_area)
# Crear un data frame con los municipios y sus superficies
municipios_area <- tibble::tribble(
~NOM_ENS,                  ~area_km2,
"Abrera",                  19.94,
"Alella",                  9.58,
"Argentona",               25.40,
"Canet de Mar",            5.56,
"Cardedeu",                12.10,
"Cardona",                 66.70,
"Centelles",               15.18,
"Cervelló",                24.10,
"Gironella",               6.78,
"Llinars del Vallès",      27.63,
"Montgat",                 2.91,
"Montmeló",                4.00,
"Navarcles",               5.50,
"Navàs",                   80.60,
"Palau-solità i Plegamans",14.93,
"Pallejà",                 8.30,
"Piera",                   57.20,
"Premià de Dalt",          6.57,
"Puig-reig",               45.75,
"Sallent",                 65.22,
"Sant Joan de Vilatorrada",16.43,
"Sant Quirze del Vallès", 14.07,
"Sant Sadurní d’Anoia",    18.96,
"Sant Vicenç de Castellet",17.13,
"Santa Margarida de Montbui",27.59,
"Súria",                   23.60,
"Tona",                    16.54,
"Tordera",                 83.97,
"Vallirana",               23.88,
"Vilanova del Camí",       10.28,
"Vilassar de Dalt",        8.87,
"la Garriga",              18.80,
"la Roca del Vallès",      36.90
)
# Unir con tu conjunto de datos pob2_small
pob2_with_area <- pob2_small %>%
left_join(municipios_area, by = "NOM_ENS")
# Verificar los resultados
head(pob2_with_area)
View(pob2_with_area)
# Nova variable densitat
pob2_with_area$density <- pob2_with_area$TOTAL/pob2_with_area$area_km2
View(pob2_with_area)
pob2_with_area <- pob2_with_area %>%
arrange(NOM_ENS, ANY) %>%
group_by(NOM_ENS) %>%
mutate(
TOTAL = as.numeric(gsub("\\.", "", density)),   # clean & convert
density_abs = density - lag(density),             # absolute growth per year
density_pct = (density - lag(density)) / lag(density) * 100  # % growth per year
) %>%
ungroup()
View(pob2_with_area)
ggplot(pob2_with_area, aes(x = ANY, y = density)) +
# punts grisos per a tots menys Cardedeu
geom_point(data = pob2_with_area %>% filter(NOM_ENS != "Cardedeu"),
color = "grey70", alpha = 0.6, size = 4) +
geom_point(data = pob2_with_area %>% filter(NOM_ENS == "Cardedeu"),
color = "green", size = 3) +
geom_line(data = pob2_with_area %>% filter(NOM_ENS == "Cardedeu"),
color = "green", line_width = 1.5) +
labs(
title = "",
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
scale_y_continuous(limits = c(-5, 10),labels = label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(pob2_with_area, aes(x = ANY, y = density)) +
# punts grisos per a tots menys Cardedeu
geom_point(data = pob2_with_area %>% filter(NOM_ENS != "Cardedeu"),
color = "grey70", alpha = 0.6, size = 4) +
geom_point(data = pob2_with_area %>% filter(NOM_ENS == "Cardedeu"),
color = "green", size = 3) +
geom_line(data = pob2_with_area %>% filter(NOM_ENS == "Cardedeu"),
color = "green", line_width = 1.5) +
labs(
title = "",
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
#scale_y_continuous(limits = c(-5, 10),labels = label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(pob2_with_area, aes(x = ANY, y = density_pct)) +
# punts grisos per a tots menys Cardedeu
geom_point(data = pob2_with_area %>% filter(NOM_ENS != "Cardedeu"),
color = "grey70", alpha = 0.6, size = 4) +
geom_point(data = pob2_with_area %>% filter(NOM_ENS == "Cardedeu"),
color = "green", size = 3) +
geom_line(data = pob2_with_area %>% filter(NOM_ENS == "Cardedeu"),
color = "green", line_width = 1.5) +
labs(
title = "",
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
#scale_y_continuous(limits = c(-5, 10),labels = label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
pob2_with_area <- pob2_with_area %>%
filter(ANY %in% c(1990, 2024)) %>%
select(NOM_ENS, ANY, density) %>%
pivot_wider(names_from = ANY, values_from = density, names_prefix = "YEAR_") %>%
mutate(
diff_density = YEAR_2024 - YEAR_1990,
density_CHANGE = (YEAR_2024 - YEAR_1990) / YEAR_1990 * 100
)
pob2_with_area <- pob2_with_area %>%
mutate(NOM_ENS = fct_reorder(NOM_ENS, diff_density))
library(dplyr)
library(forcats)
pob2_with_area <- pob2_with_area %>%
mutate(NOM_ENS = fct_reorder(NOM_ENS, diff_density, .fun = mean, na.rm = TRUE))
pob2_with_area <- pob2_with_area %>%
mutate(NOM_ENS = fct_reorder(NOM_ENS, diff_density, .fun = mean, na.rm = TRUE))
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "Diff Density",
title = "Difference in Density by Municipality"
) +
theme_minimal(base_size = 14) +
theme(axis.text.y = element_text(size = 12))
# Step 2: Convert NOM_ENS to factor ordered by diff_TOTAL
pop_diff <- pop_diff %>%
mutate(NOM_ENS = fct_reorder(NOM_ENS, diff_TOTAL))
pop_diff <- pob2_small %>%
filter(ANY %in% c(1990, 2024)) %>%
select(NOM_ENS, ANY, TOTAL) %>%
pivot_wider(names_from = ANY, values_from = TOTAL, names_prefix = "YEAR_") %>%
mutate(
diff_TOTAL = YEAR_2024 - YEAR_1990,
perc_CHANGE = (YEAR_2024 - YEAR_1990) / YEAR_1990 * 100
)
# Step 2: Convert NOM_ENS to factor ordered by diff_TOTAL
pop_diff <- pop_diff %>%
mutate(NOM_ENS = fct_reorder(NOM_ENS, diff_TOTAL))
small_hist <- pob2 %>%
filter(ANY == 1990 & TOTAL > 5000 & TOTAL < 10000) %>%
pull(NOM_ENS)
pob2_with_area <- pob2_with_area %>%
mutate(NOM_ENS = fct_reorder(NOM_ENS, diff_density, .fun = mean, na.rm = TRUE))
pob2_with_area <- pob2_with_area %>%
mutate(
NOM_ENS = as_factor(NOM_ENS),  # ensure it's a factor
NOM_ENS = fct_reorder(NOM_ENS, diff_density, .fun = function(x) mean(x, na.rm = TRUE))
)
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "Diff Density",
title = "Difference in Density by Municipality"
) +
theme_minimal(base_size = 14) +
theme(axis.text.y = element_text(size = 12))
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "",
title = "Diferència densitat de població (1990-2024)\nmunicipis de la demarcació de Barcelona\nque el 1990 tenien entre 5000 i 10000 habitants"
) +
theme_minimal(base_size = 14) +
theme(axis.text.y = element_text(size = 12))
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "",
title = "Diferència densitat de població (1990-2024) municipis de la demarcació de Barcelona que el 1990 tenien entre 5000 i 10000 habitants"
) +
theme_minimal(base_size = 14) +
theme(axis.text.y = element_text(size = 12))
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "",
title = "Diferència densitat de població (1990-2024) municipis de la demarcació de Barcelona\n que el 1990 tenien entre 5000 i 10000 habitants"
) +
theme_minimal(base_size = 14) +
theme(axis.text.y = element_text(size = 12))
View(pob2_small)
pob2_with_area <- pob2_with_area %>%
filter(!is.na(diff_density)) %>%   # remove rows where diff_density is NA
mutate(
NOM_ENS = as_factor(NOM_ENS),
NOM_ENS = fct_reorder(NOM_ENS, diff_density, .fun = mean)
)
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "",
title = "Diferència densitat de població (1990-2024) municipis de la demarcació de Barcelona\n que el 1990 tenien entre 5000 i 10000 habitants"
) +
theme_minimal(base_size = 14) +
theme(axis.text.y = element_text(size = 12))
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "",
title = "Diferència densitat de població (1990-2024) municipis de la demarcació de Barcelona\n que el 1990 tenien entre 5000 i 10000 habitants"
) +
theme_minimal(base_size = 20) +
theme(axis.text.y = element_text(size = 12))
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "",
title = "Diferència densitat de població (1990-2024)\n municipis de la demarcació de Barcelona\n que el 1990 tenien entre 5000 i 10000 habitants"
) +
theme_minimal(base_size = 20) +
theme(axis.text.y = element_text(size = 12))
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "",
title = "Diferència densitat de població (1990-2024)\n municipis de la demarcació de Barcelona\n que el 1990 tenien entre 5000 i 10000 habitants"
) +
theme_minimal(base_size = 20) +
theme(axis.text.y = element_text(size = 15),axis.text.x = element_text(size = 15))
site <- "C:/Users/marcs/starter-academic"
file.create(file.path(site, "assets", "scss", "custom.scss"))
file.create(file.path(site, "data", "themes", "custom.yaml"))
