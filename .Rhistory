<<<<<<< HEAD
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
scale_y_continuous(limits = c(-5, 10),labels = label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
View(pob2_small)
pop_diff <- pob2_small %>%
filter(ANY %in% c(1990, 2024)) %>%
select(NOM_ENS, ANY, TOTAL) %>%
pivot_wider(names_from = ANY, values_from = TOTAL, names_prefix = "YEAR_") %>%
mutate(
diff_TOTAL = YEAR_2024 - YEAR_1990,
perc_CHANGE = (YEAR_2024 - YEAR_1990) / YEAR_1990 * 100
)
# Step 2: Convert NOM_ENS to factor ordered by diff_TOTAL
pop_diff <- pop_diff %>%
mutate(NOM_ENS = fct_reorder(NOM_ENS, diff_TOTAL))
# Step 3: Boxplot (one box per NOM_ENS showing the difference)
ggplot(pop_diff, aes(x = NOM_ENS, y = diff_TOTAL, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("FALSE" = "grey80", "TRUE" = "green")) +
coord_flip() +
labs(
x = "",
y = "Diferència població (1990-2024)\nmunicipis de la demarcació de Barcelona\nque el 1990 tenien entre 5000 i 9000 habitants"
) +
theme_minimal(base_size = 20) +
theme(
legend.position = "none",
axis.title.y = element_text(size = 12)  # smaller y-axis title
)
View(pop_diff)
ggplot(pob2_small, aes(x = ANY, y = growth_pct)) +
# punts grisos per a tots menys Cardedeu
geom_point(data = pob2_small %>% filter(NOM_ENS != "Cardedeu"),
color = "grey70", alpha = 0.6, size = 4) +
geom_point(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", size = 3) +
geom_line(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", line_width = 1.5) +
geom_point(data = pob2_small %>% filter(NOM_ENS == "Llinars del Vallès"),
color = "red", size = 3) +
geom_line(data = pob2_small %>% filter(NOM_ENS == "Llinars del Vallès"),
color = "red", line_width = 1.5) +
labs(
title = "",
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
scale_y_continuous(limits = c(-5, 10),labels = label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
top3 <- pob2_small %>%
group_by(ANY) %>%
slice_max(order_by = growth_pct, n = 3) %>%
ungroup()
ggplot(pob2_small, aes(x = ANY, y = growth_pct)) +
# punts grisos per a tots menys Cardedeu
geom_point(data = pob2_small %>% filter(NOM_ENS != "Cardedeu"),
color = "grey70", alpha = 0.6, size = 4) +
geom_point(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", size = 3) +
geom_line(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", line_width = 1.5) +
# add labels for top 3
geom_text_repel(
data = top3,
aes(label = NOM_ENS),
size = 4,
nudge_y = 0.5,
min.segment.length = 0
) +
labs(
title = "",
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
scale_y_continuous(limits = c(-5, 10), labels = scales::label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
library(ggrepel)
top3 <- pob2_small %>%
group_by(ANY) %>%
slice_max(order_by = growth_pct, n = 3) %>%
ungroup()
ggplot(pob2_small, aes(x = ANY, y = growth_pct)) +
# punts grisos per a tots menys Cardedeu
geom_point(data = pob2_small %>% filter(NOM_ENS != "Cardedeu"),
color = "grey70", alpha = 0.6, size = 4) +
geom_point(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", size = 3) +
geom_line(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", line_width = 1.5) +
# add labels for top 3
geom_text_repel(
data = top3,
aes(label = NOM_ENS),
size = 4,
nudge_y = 0.5,
min.segment.length = 0
) +
labs(
title = "",
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
scale_y_continuous(limits = c(-5, 10), labels = scales::label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
top1 <- pob2_small %>%
group_by(ANY) %>%
slice_max(order_by = growth_pct, n = 1) %>%
ungroup()
ggplot(pob2_small, aes(x = ANY, y = growth_pct)) +
# punts grisos per a tots menys Cardedeu
geom_point(data = pob2_small %>% filter(NOM_ENS != "Cardedeu"),
color = "grey70", alpha = 0.6, size = 4) +
geom_point(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", size = 3) +
geom_line(data = pob2_small %>% filter(NOM_ENS == "Cardedeu"),
color = "green", line_width = 1.5) +
# add labels for top 3
geom_text_repel(
data = top1,
aes(label = NOM_ENS),
size = 4,
nudge_y = 0.5,
min.segment.length = 0
) +
labs(
title = "",
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
scale_y_continuous(limits = c(-5, 10), labels = scales::label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
names(pob2_small)
names(pob2_small$NOM_ENS)
levels(pob2_small$NOM_ENS)
library(stringr)
library(ggplot2)
library(dplyr)
library(tidyr)
library(magrittr)
library(scales)
library(forcats)
pob2 <- read.csv("C:/Users/marcs/Google Drive/Z-Resta/Cardedeu/Població/pob2.csv", sep = ",", encoding = "UTF-8")
pob2$NOM_ENS <- gsub("^Ajuntament de ", "", pob2$NOM_ENS)
pob2$NOM_ENS <- gsub("^Ajuntament d'", "", pob2$NOM_ENS)
pob2 <- pob2 %>% filter(str_starts(CODI_10, "8"))
pob2 <- pob2 %>%
filter(!str_starts(NOM_ENS, "Consell Comarcal") & !str_starts(NOM_ENS, "Diputació") & !str_starts(NOM_ENS, "Conselh"))
pob2 <- pob2 %>%
arrange(NOM_ENS, ANY) %>%
group_by(NOM_ENS) %>%
mutate(
TOTAL = as.numeric(gsub("\\.", "", TOTAL)),   # clean & convert
growth_abs = TOTAL - lag(TOTAL),             # absolute growth per year
growth_pct = (TOTAL - lag(TOTAL)) / lag(TOTAL) * 100  # % growth per year
) %>%
ungroup()
small_munis <- pob2 %>%
filter(ANY == 1990 & TOTAL > 5000 & TOTAL < 10000) %>%
pull(NOM_ENS)
library(stringr)
library(ggplot2)
library(dplyr)
library(tidyr)
library(magrittr)
library(scales)
library(forcats)
## Dades població més antigues 1990
pob2 <- read.csv("C:/Users/marcs/Google Drive/Z-Resta/Cardedeu/Població/pob2.csv", sep = ",", encoding = "UTF-8")
pob2$NOM_ENS <- gsub("^Ajuntament de ", "", pob2$NOM_ENS)
pob2$NOM_ENS <- gsub("^Ajuntament d'", "", pob2$NOM_ENS)
pob2 <- pob2 %>% filter(str_starts(CODI_10, "8"))
pob2 <- pob2 %>%
filter(!str_starts(NOM_ENS, "Consell Comarcal") & !str_starts(NOM_ENS, "Diputació") & !str_starts(NOM_ENS, "Conselh"))
pob2 <- pob2 %>%
arrange(NOM_ENS, ANY) %>%
group_by(NOM_ENS) %>%
mutate(
TOTAL = as.numeric(gsub("\\.", "", TOTAL)),   # clean & convert
growth_abs = TOTAL - lag(TOTAL),             # absolute growth per year
growth_pct = (TOTAL - lag(TOTAL)) / lag(TOTAL) * 100  # % growth per year
) %>%
ungroup()
small_munis <- pob2 %>%
filter(ANY == 1990 & TOTAL > 5000 & TOTAL < 10000) %>%
pull(NOM_ENS)
# Keep all years for these municipalities
pob2_small <- pob2 %>%
filter(NOM_ENS %in% small_munis)
View(pob2_small)
small_munis
# Crear un data frame con los municipios y sus superficies
municipios_area <- tibble::tribble(
~NOM_ENS,                  ~area_km2,
"Abrera",                  19.94,
"Alella",                  9.58,
"Argentona",               25.40,
"Canet de Mar",            5.56,
"Cardedeu",                12.10,
"Cardona",                 66.70,
"Centelles",               15.18,
"Cervelló",                24.10,
"Gironella",               6.78,
"Llinars del Vallès",      27.63,
"Montgat",                 2.91,
"Montmeló",                4.00,
"Navarcles",               5.50,
"Navàs",                   80.60,
"Palau-solità i Plegamans",14.93,
"Pallejà",                 8.30,
"Piera",                   57.20,
"Premià de Dalt",          6.57,
"Puig-reig",               45.75,
"Sallent",                 65.22,
"Sant Joan de Vilatorrada",16.43,
"Sant Quirze del Vallès", 14.07,
"Sant Sadurní d’Anoia",    18.96,
"Sant Vicenç de Castellet",17.13,
"Santa Margarida de Montbui",27.59,
"Súria",                   23.60,
"Tona",                    16.54,
"Tordera",                 83.97,
"Vallirana",               23.88,
"Vilanova del Camí",       10.28,
"Vilassar de Dalt",        8.87,
"La Garriga",              18.80,
"La Roca del Vallès",      36.90
)
# Unir con tu conjunto de datos pob2_small
pob2_with_area <- pob2_small %>%
left_join(municipios_area, by = "NOM_ENS")
# Verificar los resultados
head(pob2_with_area)
View(pob2_with_area)
View(municipios_area)
# Unir con tu conjunto de datos pob2_small
pob2_with_area <- pob2_small %>%
left_join(municipios_area, by = "NOM_ENS")
View(pob2_with_area)
# Crear un data frame con los municipios y sus superficies
municipios_area <- tibble::tribble(
~NOM_ENS,                  ~area_km2,
"Abrera",                  19.94,
"Alella",                  9.58,
"Argentona",               25.40,
"Canet de Mar",            5.56,
"Cardedeu",                12.10,
"Cardona",                 66.70,
"Centelles",               15.18,
"Cervelló",                24.10,
"Gironella",               6.78,
"Llinars del Vallès",      27.63,
"Montgat",                 2.91,
"Montmeló",                4.00,
"Navarcles",               5.50,
"Navàs",                   80.60,
"Palau-solità i Plegamans",14.93,
"Pallejà",                 8.30,
"Piera",                   57.20,
"Premià de Dalt",          6.57,
"Puig-reig",               45.75,
"Sallent",                 65.22,
"Sant Joan de Vilatorrada",16.43,
"Sant Quirze del Vallès", 14.07,
"Sant Sadurní d’Anoia",    18.96,
"Sant Vicenç de Castellet",17.13,
"Santa Margarida de Montbui",27.59,
"Súria",                   23.60,
"Tona",                    16.54,
"Tordera",                 83.97,
"Vallirana",               23.88,
"Vilanova del Camí",       10.28,
"Vilassar de Dalt",        8.87,
"la Garriga",              18.80,
"la Roca del Vallès",      36.90
)
# Unir con tu conjunto de datos pob2_small
pob2_with_area <- pob2_small %>%
left_join(municipios_area, by = "NOM_ENS")
# Verificar los resultados
head(pob2_with_area)
View(pob2_with_area)
# Nova variable densitat
pob2_with_area$density <- pob2_with_area$TOTAL/pob2_with_area$area_km2
View(pob2_with_area)
pob2_with_area <- pob2_with_area %>%
arrange(NOM_ENS, ANY) %>%
group_by(NOM_ENS) %>%
mutate(
TOTAL = as.numeric(gsub("\\.", "", density)),   # clean & convert
density_abs = density - lag(density),             # absolute growth per year
density_pct = (density - lag(density)) / lag(density) * 100  # % growth per year
) %>%
ungroup()
View(pob2_with_area)
ggplot(pob2_with_area, aes(x = ANY, y = density)) +
# punts grisos per a tots menys Cardedeu
geom_point(data = pob2_with_area %>% filter(NOM_ENS != "Cardedeu"),
color = "grey70", alpha = 0.6, size = 4) +
geom_point(data = pob2_with_area %>% filter(NOM_ENS == "Cardedeu"),
color = "green", size = 3) +
geom_line(data = pob2_with_area %>% filter(NOM_ENS == "Cardedeu"),
color = "green", line_width = 1.5) +
labs(
title = "",
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
scale_y_continuous(limits = c(-5, 10),labels = label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(pob2_with_area, aes(x = ANY, y = density)) +
# punts grisos per a tots menys Cardedeu
geom_point(data = pob2_with_area %>% filter(NOM_ENS != "Cardedeu"),
color = "grey70", alpha = 0.6, size = 4) +
geom_point(data = pob2_with_area %>% filter(NOM_ENS == "Cardedeu"),
color = "green", size = 3) +
geom_line(data = pob2_with_area %>% filter(NOM_ENS == "Cardedeu"),
color = "green", line_width = 1.5) +
labs(
title = "",
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
#scale_y_continuous(limits = c(-5, 10),labels = label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(pob2_with_area, aes(x = ANY, y = density_pct)) +
# punts grisos per a tots menys Cardedeu
geom_point(data = pob2_with_area %>% filter(NOM_ENS != "Cardedeu"),
color = "grey70", alpha = 0.6, size = 4) +
geom_point(data = pob2_with_area %>% filter(NOM_ENS == "Cardedeu"),
color = "green", size = 3) +
geom_line(data = pob2_with_area %>% filter(NOM_ENS == "Cardedeu"),
color = "green", line_width = 1.5) +
labs(
title = "",
x = "",
y = ""
) +
scale_x_continuous(breaks = seq(1991, 2024, 1)) +
#scale_y_continuous(limits = c(-5, 10),labels = label_percent(scale = 1)) +
theme_minimal(base_size = 25) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
pob2_with_area <- pob2_with_area %>%
filter(ANY %in% c(1990, 2024)) %>%
select(NOM_ENS, ANY, density) %>%
pivot_wider(names_from = ANY, values_from = density, names_prefix = "YEAR_") %>%
mutate(
diff_density = YEAR_2024 - YEAR_1990,
density_CHANGE = (YEAR_2024 - YEAR_1990) / YEAR_1990 * 100
)
pob2_with_area <- pob2_with_area %>%
mutate(NOM_ENS = fct_reorder(NOM_ENS, diff_density))
library(dplyr)
library(forcats)
pob2_with_area <- pob2_with_area %>%
mutate(NOM_ENS = fct_reorder(NOM_ENS, diff_density, .fun = mean, na.rm = TRUE))
pob2_with_area <- pob2_with_area %>%
mutate(NOM_ENS = fct_reorder(NOM_ENS, diff_density, .fun = mean, na.rm = TRUE))
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "Diff Density",
title = "Difference in Density by Municipality"
) +
theme_minimal(base_size = 14) +
theme(axis.text.y = element_text(size = 12))
# Step 2: Convert NOM_ENS to factor ordered by diff_TOTAL
pop_diff <- pop_diff %>%
mutate(NOM_ENS = fct_reorder(NOM_ENS, diff_TOTAL))
pop_diff <- pob2_small %>%
filter(ANY %in% c(1990, 2024)) %>%
select(NOM_ENS, ANY, TOTAL) %>%
pivot_wider(names_from = ANY, values_from = TOTAL, names_prefix = "YEAR_") %>%
mutate(
diff_TOTAL = YEAR_2024 - YEAR_1990,
perc_CHANGE = (YEAR_2024 - YEAR_1990) / YEAR_1990 * 100
)
# Step 2: Convert NOM_ENS to factor ordered by diff_TOTAL
pop_diff <- pop_diff %>%
mutate(NOM_ENS = fct_reorder(NOM_ENS, diff_TOTAL))
small_hist <- pob2 %>%
filter(ANY == 1990 & TOTAL > 5000 & TOTAL < 10000) %>%
pull(NOM_ENS)
pob2_with_area <- pob2_with_area %>%
mutate(NOM_ENS = fct_reorder(NOM_ENS, diff_density, .fun = mean, na.rm = TRUE))
pob2_with_area <- pob2_with_area %>%
mutate(
NOM_ENS = as_factor(NOM_ENS),  # ensure it's a factor
NOM_ENS = fct_reorder(NOM_ENS, diff_density, .fun = function(x) mean(x, na.rm = TRUE))
)
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "Diff Density",
title = "Difference in Density by Municipality"
) +
theme_minimal(base_size = 14) +
theme(axis.text.y = element_text(size = 12))
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "",
title = "Diferència densitat de població (1990-2024)\nmunicipis de la demarcació de Barcelona\nque el 1990 tenien entre 5000 i 10000 habitants"
) +
theme_minimal(base_size = 14) +
theme(axis.text.y = element_text(size = 12))
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "",
title = "Diferència densitat de població (1990-2024) municipis de la demarcació de Barcelona que el 1990 tenien entre 5000 i 10000 habitants"
) +
theme_minimal(base_size = 14) +
theme(axis.text.y = element_text(size = 12))
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "",
title = "Diferència densitat de població (1990-2024) municipis de la demarcació de Barcelona\n que el 1990 tenien entre 5000 i 10000 habitants"
) +
theme_minimal(base_size = 14) +
theme(axis.text.y = element_text(size = 12))
View(pob2_small)
pob2_with_area <- pob2_with_area %>%
filter(!is.na(diff_density)) %>%   # remove rows where diff_density is NA
mutate(
NOM_ENS = as_factor(NOM_ENS),
NOM_ENS = fct_reorder(NOM_ENS, diff_density, .fun = mean)
)
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "",
title = "Diferència densitat de població (1990-2024) municipis de la demarcació de Barcelona\n que el 1990 tenien entre 5000 i 10000 habitants"
) +
theme_minimal(base_size = 14) +
theme(axis.text.y = element_text(size = 12))
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "",
title = "Diferència densitat de població (1990-2024) municipis de la demarcació de Barcelona\n que el 1990 tenien entre 5000 i 10000 habitants"
) +
theme_minimal(base_size = 20) +
theme(axis.text.y = element_text(size = 12))
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "",
title = "Diferència densitat de població (1990-2024)\n municipis de la demarcació de Barcelona\n que el 1990 tenien entre 5000 i 10000 habitants"
) +
theme_minimal(base_size = 20) +
theme(axis.text.y = element_text(size = 12))
# Plot
ggplot(pob2_with_area, aes(x = NOM_ENS, y = diff_density, fill = NOM_ENS == "Cardedeu")) +
geom_col() +
scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "grey70"), guide = "none") +
coord_flip() +  # flip axes for horizontal bars
labs(
x = "",
y = "",
title = "Diferència densitat de població (1990-2024)\n municipis de la demarcació de Barcelona\n que el 1990 tenien entre 5000 i 10000 habitants"
) +
theme_minimal(base_size = 20) +
theme(axis.text.y = element_text(size = 15),axis.text.x = element_text(size = 15))
=======
"GDP share",
"Population share",
"Area share",
"Colony"),
type="html",
out = "Agreement.html",
omit.summary.stat = c("p25", "p75"),
digits=2,
font.size="footnotesize",
title = "", header=FALSE)
View(data_all)
modelf <- data %>%
select(c("Agreement",
"Competition.proximity",
"Democracy",
"State",
"Reputation",
"Time",
"Hydrocarbons",
"Violence",
"Decentralization",
"GDP",
"Population",
"Area",
"Colony",
"ID", "Host.state"))
modelf <- filter(modelf, Democracy > 0.5)
View(modelf)
model_5 <- plm(Agreement ~
Competition.proximity +
Democracy +
Reputation +
Time +
Hydrocarbons +
Violence +
Decentralization +
GDP +
Population +
Area +
Colony + as.factor(Host.state), index=c("ID"),  data=model1, model="pooling")
model_5 <- plm(Agreement ~
Competition.proximity +
Democracy +
Reputation +
Time +
Hydrocarbons +
Violence +
Decentralization +
GDP +
Population +
Area +
Colony + as.factor(Host.state), index=c("ID"),  data=modelf, model="pooling")
summary(model_5)
stargazer(model_1, model_2,model_3,model_4, model_5, omit = "Host.state",
add.lines = list(c("Model 1: democracies (>0.5)",
"Model 2: relaxed dem. (>0.3)",
"Model 3: relaxed dem. (>0.3) without 1958 French referendums",
"Model 4: all referendums since 1945", "Model 5: Model 1 with fixed effects by state")),
dep.var.labels   = "Parent State Agreement",
covariate.labels = c("Competition/Proximity",
"Level of democracy",
"Reputation",
"Time",
"Hydrocarbons",
"Previous violence",
"Decentralization",
"GDP share",
"Population share",
"Area share",
"Colony"),
type="html",
out = "Agreement.html",
omit.summary.stat = c("p25", "p75"),
digits=2,
font.size="footnotesize",
title = "", header=FALSE)
stargazer(model_1, model_2,model_3,model_4, model_5, omit = "Host.state",
add.lines = list(c("Model 1: democracies (>0.5);",
"Model 2: relaxed dem. (>0.3);",
"Model 3: relaxed dem. (>0.3) without 1958 French referendums;",
"Model 4: all referendums since 1945;", "Model 5: Model 1 with fixed effects by state.")),
dep.var.labels   = "Parent State Agreement",
covariate.labels = c("Competition/Proximity",
"Level of democracy",
"Reputation",
"Time",
"Hydrocarbons",
"Previous violence",
"Decentralization",
"GDP share",
"Population share",
"Area share",
"Colony"),
type="html",
out = "Agreement.html",
omit.summary.stat = c("p25", "p75"),
digits=2,
font.size="footnotesize",
title = "", header=FALSE)
View(data_all)
data_all <- read.csv2("G:/La meva unitat/1.Publicacions/En curs/2023/Ethnic_and_Racial_Studies_2023/R&R_Democratization/Analysis/Data_all.csv", sep = ";", encoding = "UTF-8")
data <- data_all %>% mutate_at(c("Agreement",
"Competition.proximity",
"Democracy",
"Experience",
"State",
"Colony",
"Reputation",
"Time",
"Hydrocarbons",
"Violence",
"Decentralization",
"GDP",
"Population",
"Area",
"Contiguity"), as.numeric)
setwd("G:/La meva unitat/1.Publicacions/En curs/2023/Ethnic_and_Racial_Studies_2023/R&R_Democratization/Analysis/")
View(data_all)
View(data)
model <- data %>%
select(c("Agreement",
"Competition.proximity",
"Democracy",
"Experience",
"State",
"Reputation",
"Time",
"Hydrocarbons",
"Violence",
"Decentralization",
"GDP",
"Population",
"Area",
"Colony",
"ID"))
View(model)
desc <- model %>%
select(c("Agreement",
"Competition.proximity",
"Democracy",
"Experience",
"State",
"Reputation",
"Time",
"Hydrocarbons",
"Violence",
"Decentralization",
"GDP",
"Population",
"Area",
"Colony"))
stargazer(desc,
covariate.labels = c("State Agreement",
"Competition/Proximity",
"Level of democracy (V-Dem)",
"Experience",
"State Creation",
"Reputation",
"Time",
"Hydrocarbons",
"Previous violence",
"Level of decentralization (RAI)",
"GDP share",
"Population share",
"Area share",
"Colony"),
type="html",
out = "Descriptive.html",
summary.stat = c("n", "min", "p25", "mean", "p75", "max", "median", "sd"),
digits=3,
font.size="footnotesize",
title = "", header=FALSE)
model1 <- filter(model, Democracy > 0.5)
model_1 <- plm(Agreement ~
Competition.proximity +
Democracy +
Experience +
Reputation +
Time +
Hydrocarbons +
Violence +
Decentralization +
GDP +
Population +
Area +
Colony, index=c("ID"),  data=model1, model="pooling")
summary(model_1)
model2 <- filter(model, Democracy > 0.3)
model_2 <- plm(Agreement ~
Competition.proximity +
Democracy +
Experience +
Reputation +
Time +
Hydrocarbons +
Violence +
Decentralization +
GDP +
Population +
Area +
Colony, index=c("ID"),  data=model2, model="pooling")
summary(model_2)
model_fr <- data %>%
filter(Democracy > 0.5, Year != 1958)%>%
select(c("Agreement",
"Competition.proximity",
"Democracy",
"Experience",
"State",
"Reputation",
"Time",
"Hydrocarbons",
"Violence",
"Decentralization",
"GDP",
"Population",
"Area",
"Colony",
"ID"))
model_fr <- data %>%
filter(Democracy > 0.5, Year != 1958)%>%
select(c("Agreement",
"Competition.proximity",
"Democracy",
"Experience",
"State",
"Reputation",
"Time",
"Hydrocarbons",
"Violence",
"Decentralization",
"GDP",
"Population",
"Area",
"Colony",
"ID"))
model_3 <- plm(Agreement ~
Competition.proximity +
Democracy +
Experience +
Reputation +
Time +
Hydrocarbons +
Violence +
Decentralization +
GDP +
Population +
Area +
Colony, index=c("ID"),  data=model_fr, model="pooling")
summary(model_3)
model_4 <- plm(Agreement ~
Competition.proximity +
Democracy +
Experience +
Reputation +
Time +
Hydrocarbons +
Violence +
Decentralization +
GDP +
Population +
Area +
Colony, index=c("ID"),  data=model, model="pooling")
modelf <- data %>%
select(c("Agreement",
"Competition.proximity",
"Democracy",
"Experience",
"State",
"Reputation",
"Time",
"Hydrocarbons",
"Violence",
"Decentralization",
"GDP",
"Population",
"Area",
"Colony",
"ID", "Host.state"))
modelf <- filter(modelf, Democracy > 0.5)
model_5 <- plm(Agreement ~
Competition.proximity +
Democracy +
Experience +
Reputation +
Time +
Hydrocarbons +
Violence +
Decentralization +
GDP +
Population +
Area +
Colony + as.factor(Host.state), index=c("ID"),  data=modelf, model="pooling")
summary(model_5)
stargazer(model_1, model_2,model_3,model_4, model_5, omit = "Host.state",
add.lines = list(c("Model 1: democracies (>0.5);",
"Model 2: relaxed dem. (>0.3);",
"Model 3: relaxed dem. (>0.3) without 1958 French referendums;",
"Model 4: all referendums since 1945;", "Model 5: Model 1 with fixed effects by state.")),
dep.var.labels   = "Parent State Agreement",
covariate.labels = c("Competition/Proximity",
"Level of democracy",
"Experience",
"Reputation",
"Time",
"Hydrocarbons",
"Previous violence",
"Decentralization",
"GDP share",
"Population share",
"Area share",
"Colony"),
type="html",
out = "Agreement.html",
omit.summary.stat = c("p25", "p75"),
digits=2,
font.size="footnotesize",
title = "", header=FALSE)
stargazer(desc,
covariate.labels = c("State Agreement",
"Competition/Proximity",
"Level of democracy (V-Dem)",
"Experience",
"State Creation",
"Reputation",
"Time",
"Hydrocarbons",
"Previous violence",
"Level of decentralization (RAI)",
"GDP share",
"Population share",
"Area share",
"Colony"),
type="html",
out = "Descriptive.html",
summary.stat = c("n", "min", "p25", "mean", "p75", "max", "median", "sd"),
digits=1,
font.size="footnotesize",
title = "", header=FALSE)
stargazer(desc,
covariate.labels = c("State Agreement",
"Competition/Proximity",
"Level of democracy (V-Dem)",
"Experience",
"State Creation",
"Reputation",
"Time",
"Hydrocarbons",
"Previous violence",
"Level of decentralization (RAI)",
"GDP share",
"Population share",
"Area share",
"Colony"),
type="pdf_document",
out = "Descriptive.html",
summary.stat = c("n", "min", "p25", "mean", "p75", "max", "median", "sd"),
digits=1,
font.size="footnotesize",
title = "", header=FALSE)
stargazer(desc,
covariate.labels = c("State Agreement",
"Competition/Proximity",
"Level of democracy (V-Dem)",
"Experience",
"State Creation",
"Reputation",
"Time",
"Hydrocarbons",
"Previous violence",
"Level of decentralization (RAI)",
"GDP share",
"Population share",
"Area share",
"Colony"),
type="latex",
out = "Descriptive.html",
summary.stat = c("n", "min", "p25", "mean", "p75", "max", "median", "sd"),
digits=1,
font.size="footnotesize",
title = "", header=FALSE)
setwd("G:/La meva unitat/1.Publicacions/En curs/2024/Quebec_Catalonia_2024_FormerTiebout/DadesCredibilitat")
data <- read_sav("ICPS.sav")
library(haven)
data <- read_sav("ICPS.sav")
# Collapse categories 8 and 9 in V203
data <- data %>%
mutate(V203 = ifelse(V203 %in% c(8, 9), 8, V203))  # Combine categories 8 and 9 into 8
library(magrittr)
# Collapse categories 8 and 9 in V203
data <- data %>%
mutate(V203 = ifelse(V203 %in% c(8, 9), 8, V203))  # Combine categories 8 and 9 into 8
library(dplyr)
library(tidyverse)
library(ggplot2)
# Collapse categories 8 and 9 in V203
data <- data %>%
mutate(V203 = ifelse(V203 %in% c(8, 9), 8, V203))  # Combine categories 8 and 9 into 8
# Update category labels for V203
category_labels <- c(
"1" = "With the independence of Catalonia",
"2" = "With an agreement with Spain to grant Catalonia more self-government",
"3" = "With the abandonment of the process",
"8" = "Does not know/answer"
)
data_summary <- data %>%
group_by(ANY, V203, V529) %>%  # Group by year, response category, and language
summarise(Count = n(), .groups = "drop") %>%  # Count responses per category
group_by(ANY, V529) %>%  # Group by year and language
mutate(Percentage = (Count / sum(Count)) * 100) %>%  # Calculate percentage within each language group
ungroup()
View(data_summary)
# Apply the category labels to V203
data_summary$Category <- factor(data_summary$V203, levels = names(category_labels), labels = category_labels)
# Convert V529 to a factor and set the labels for the language variable
data_summary_filtered <- data_summary %>%
filter(V529 %in% c(1, 2, 3)) %>%  # Keep only Catalan, Spanish, and Both responses
mutate(Language = factor(V529, levels = c(1, 2, 3), labels = c("Catalan", "Spanish", "Both")))  # Set the labels
# Plot the data using ggplot
ggplot(data_summary_filtered, aes(x = ANY, y = Percentage, group = Category, color = Category, shape = Category, lty = Category)) +
scale_x_continuous(limits = c(2015, 2023), breaks = 2015:2023) +
scale_y_continuous(labels = scales::percent_format(scale = 1), limits = c(0, 60)) +
geom_line(size = 1) +  # Add lines with lty mapped to Category
geom_point(size = 3) +  # Add points with different shapes
scale_color_manual(values = c("With the independence of Catalonia" = "grey10",
"With an agreement with Spain to grant Catalonia more self-government" = "grey30",
"With the abandonment of the process" = "grey50",
"Does not know/answer" = "grey70")) +  # Example grey shades
scale_shape_manual(values = c("With the independence of Catalonia" = 16,  # Solid circle
"With an agreement with Spain to grant Catalonia more self-government" = 17,  # Triangle
"With the abandonment of the process" = 18,  # Square
"Does not know/answer" = 19)) +  # Filled circle
scale_linetype_manual(values = c("With the independence of Catalonia" = "solid",
"With an agreement with Spain to grant Catalonia more self-government" = "dashed",
"With the abandonment of the process" = "dotted",
"Does not know/answer" = "dotdash")) +  # Add line type
labs(
title = "Evolution of independence process credibility by language spoken at home (2015-2023)",
x = "",
y = "",
color = "How will the independence process end?",  # Legend title changed to Response
shape = "How will the independence process end?",  # Legend title changed to Response
lty = "How will the independence process end?"     # Add lty to the legend
) +
theme_minimal(base_size = 20) +
theme(
text = element_text(color = "black"),
panel.grid.major = element_line(color = "gray"),
panel.grid.minor = element_line(color = "lightgray"),
legend.position = "bottom",  # Position the legend below the plot
legend.box = "vertical",  # Arrange the legend items vertically (default)
legend.margin = margin(t = 10),  # Add some space above the legend
legend.box.spacing = unit(1, "cm"),  # Space between legend and plot
legend.key.size = unit(1.5, "lines"),  # Increase the size of legend keys
legend.text.align = 0,  # Align the legend text to the left
legend.title.align = 0,  # Center align the legend title
legend.direction = "vertical",  # Stack items vertically
legend.spacing.y = unit(0.1, "lines"),  # Increase spacing between rows
legend.title = element_text(size = 18),  # Size of the legend title
legend.text = element_text(size = 18),  # Size of the legend text
strip.text = element_text(size = 16),  # Adjust facet label size
strip.background = element_blank(),  # Remove background from facet labels
axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels by 45 degrees
) +
facet_wrap(~ Language)  # Facet by Language (Catalan, Spanish, Both)
# Plot the data using ggplot
ggplot(data_summary_filtered, aes(x = ANY, y = Percentage, group = Category, color = Category, shape = Category, lty = Category)) +
scale_x_continuous(limits = c(2015, 2023), breaks = 2015:2023) +
scale_y_continuous(labels = scales::percent_format(scale = 1), limits = c(0, 60)) +
geom_line(size = 1) +  # Add lines with lty mapped to Category
geom_point(size = 3) +  # Add points with different shapes
scale_color_manual(values = c("With the independence of Catalonia" = "grey10",
"With an agreement with Spain to grant Catalonia more self-government" = "grey30",
"With the abandonment of the process" = "grey50",
"Does not know/answer" = "grey70")) +  # Example grey shades
scale_shape_manual(values = c("With the independence of Catalonia" = 16,  # Solid circle
"With an agreement with Spain to grant Catalonia more self-government" = 17,  # Triangle
"With the abandonment of the process" = 18,  # Square
"Does not know/answer" = 19)) +  # Filled circle
scale_linetype_manual(values = c("With the independence of Catalonia" = "solid",
"With an agreement with Spain to grant Catalonia more self-government" = "dashed",
"With the abandonment of the process" = "dotted",
"Does not know/answer" = "dotdash")) +  # Add line type
labs(
title = "",
x = "",
y = "",
color = "How will the independence process end?",  # Legend title changed to Response
shape = "How will the independence process end?",  # Legend title changed to Response
lty = "How will the independence process end?"     # Add lty to the legend
) +
theme_minimal(base_size = 20) +
theme(
text = element_text(color = "black"),
panel.grid.major = element_line(color = "gray"),
panel.grid.minor = element_line(color = "lightgray"),
legend.position = "bottom",  # Position the legend below the plot
legend.box = "vertical",  # Arrange the legend items vertically (default)
legend.margin = margin(t = 10),  # Add some space above the legend
legend.box.spacing = unit(1, "cm"),  # Space between legend and plot
legend.key.size = unit(1.5, "lines"),  # Increase the size of legend keys
legend.text.align = 0,  # Align the legend text to the left
legend.title.align = 0,  # Center align the legend title
legend.direction = "vertical",  # Stack items vertically
legend.spacing.y = unit(0.1, "lines"),  # Increase spacing between rows
legend.title = element_text(size = 18),  # Size of the legend title
legend.text = element_text(size = 18),  # Size of the legend text
strip.text = element_text(size = 16),  # Adjust facet label size
strip.background = element_blank(),  # Remove background from facet labels
axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels by 45 degrees
) +
facet_wrap(~ Language)  # Facet by Language (Catalan, Spanish, Both)
>>>>>>> 7ca7cb8b3f574e716e361d085c679f47f73fe2e1
